<!DOCTYPE html>
<html>
<head>
  <title>Trapezoid Cushion Form</title>
  <script>
    function addCushion() {
      const container = document.getElementById("cushions");
      const index = container.children.length;
      const section = document.createElement("div");
      section.innerHTML = `
        <h3>Cushion ${index + 1}</h3>
        <label>Top Base (in): <input name="top_base_${index}" required></label><br>
        <label>Bottom Base (in): <input name="bottom_base_${index}" required></label><br>
        <label>Height (in): <input name="height_${index}" required></label><br>
        <label>Zipper: 
          <select name="zipper_${index}">
            <option>Top</option><option>Bottom</option><option>Left</option><option>Right</option>
          </select>
        </label><br>
        <label>Piping: 
          <select name="piping_${index}">
            <option>Yes</option><option>No</option>
          </select>
        </label><br>
        <label>Ties: 
          <select name="ties_${index}">
            <option>2 Back Ties</option>
            <option>2 Corner Ties</option>
            <option>2 Side Ties</option>
            <option>4 Corner Ties</option>
          </select>
        </label><br>
        <label>Product Details (comma-separated): <input name="product_details_${index}" required></label><br><br>
      `;
      container.appendChild(section);
    }

    async function submitForm() {
      const form = document.forms["cushionForm"];
      const cushions = [];
      for (let i = 0; i < document.getElementById("cushions").children.length; i++) {
        cushions.push({
          top_base: parseFloat(form[`top_base_${i}`].value),
          bottom_base: parseFloat(form[`bottom_base_${i}`].value),
          height: parseFloat(form[`height_${i}`].value),
          zipper: form[`zipper_${i}`].value,
          piping: form[`piping_${i}`].value,
          ties: form[`ties_${i}`].value,
          product_details: form[`product_details_${i}`].value.split(",").map(s => s.trim())
        });
      }

      const payload = {
        customer_name: form.customer_name.value,
        order_number: form.order_number.value,
        email: form.email.value,
        shipping_address: form.shipping_address.value,
        billing_address: form.billing_address.value,
        location: form.location.value,
        delivery_method: form.delivery_method.value,
        cushions: cushions
      };

      const res = await fetch('/generate-trapezoid', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const result = await res.json();
      if (result.pdf_link) {
        window.open(result.pdf_link, '_blank');
      } else {
        alert("Error: " + JSON.stringify(result));
      }
    }
  </script>
</head>
<body>
  <h1>Trapezoid Cushion Order</h1>
  <form name="cushionForm" onsubmit="event.preventDefault(); submitForm();">
    <label>Customer Name: <input name="customer_name" required></label><br>
    <label>Order Number: <input name="order_number" required></label><br>
    <label>Email: <input name="email" type="email" required></label><br>
    <label>Shipping Address: <input name="shipping_address" required></label><br>
    <label>Billing Address: <input name="billing_address" required></label><br>
    <label>Location: <input name="location" required></label><br>
    <label>Delivery Method: <input name="delivery_method" required></label><br><br>

    <div id="cushions"></div>
    <button type="button" onclick="addCushion()">Add Cushion</button><br><br>
    <button type="submit">Submit</button>
  </form>
</body>
</html>
