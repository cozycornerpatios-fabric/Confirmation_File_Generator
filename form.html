<!DOCTYPE html>
<html>
<head>
  <title>Generate Confirmation PDF</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      padding: 20px; 
      max-width: 1200px; 
      margin: 0 auto;
      background-color: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    input, select, button, textarea { 
      margin: 8px 0; 
      display: block; 
      width: 100%; 
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 5px;
      box-sizing: border-box;
    }
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #007bff;
      box-shadow: 0 0 5px rgba(0,123,255,0.3);
    }
    .cushion-group { 
      border: 2px solid #e9ecef; 
      padding: 20px; 
      margin-bottom: 20px; 
      border-radius: 8px;
      background: #f8f9fa;
    }
    .cushion-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #dee2e6;
    }
    .remove-btn {
      background: #dc3545;
      color: white;
      border: none;
      padding: 5px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    .remove-btn:hover {
      background: #c82333;
    }
    .shape-fields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 15px;
    }
    .field-group {
      margin-bottom: 10px;
    }
    .field-group label {
      font-weight: bold;
      color: #495057;
      margin-bottom: 5px;
      display: block;
    }
    .btn-primary {
      background: #007bff;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
      margin: 10px 5px;
    }
    .btn-primary:hover {
      background: #0056b3;
    }
    .btn-secondary {
      background: #6c757d;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
    }
    .btn-secondary:hover {
      background: #545b62;
    }
    h2 {
      color: #343a40;
      text-align: center;
      margin-bottom: 30px;
    }
    h3 {
      color: #495057;
      margin-top: 30px;
      margin-bottom: 20px;
    }
    .info-section {
      background: #e7f3ff;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      border-left: 4px solid #007bff;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Generate Confirmation PDF</h2>
    
    <div class="info-section">
      <strong>Note:</strong> The system automatically detects cushion shapes based on the dimensions you provide. 
      Make sure to fill in all required measurements for accurate shape detection.
    </div>

    <form id="pdfForm">
      <div class="field-group">
        <label>Customer Name</label>
        <input name="customer_name" required>
      </div>
      
      <div class="field-group">
        <label>Order ID</label>
        <input name="order_id" required>
      </div>
      
      <div class="field-group">
        <label>Email</label>
        <input name="email" type="email" required>
      </div>
      
      <div class="field-group">
        <label>Shipping Address (one per line)</label>
        <textarea name="shipping_address" required rows="3"></textarea>
      </div>
      
      <div class="field-group">
        <label>Billing Address (one per line)</label>
        <textarea name="billing_address" required rows="3"></textarea>
      </div>

      <h3>Cushions</h3>
      <div id="cushionsContainer"></div>
      <button type="button" class="btn-secondary" onclick="addCushion()">Add Cushion</button>

      <br><button type="submit" class="btn-primary">Generate PDF</button>
    </form>
  </div>

  <script>
    let cushionIndex = 0;

    function addCushion() {
      const container = document.getElementById("cushionsContainer");
      const div = document.createElement("div");
      div.className = "cushion-group";
      div.innerHTML = `
        <div class="cushion-header">
          <h4>Cushion ${cushionIndex + 1}</h4>
          <button type="button" class="remove-btn" onclick="removeCushion(this)">Remove</button>
        </div>
        
        <div class="field-group">
          <label>Cushion Name</label>
          <input name="cushion_name_${cushionIndex}" required placeholder="e.g., Living Room Cushion">
        </div>
        
        <div class="field-group">
          <label>Fill</label>
          <input name="fill_${cushionIndex}" required placeholder="e.g., Polyester, Memory Foam">
        </div>
        
        <div class="field-group">
          <label>Fabric</label>
          <input name="fabric_${cushionIndex}" required placeholder="e.g., Cotton, Polyester">
        </div>
        
        <div class="field-group">
          <label>Zipper Position</label>
          <select name="zipper_${cushionIndex}" required>
            <option value="">Select zipper position</option>
            <option value="Long Side">Long Side</option>
            <option value="Short Side">Short Side</option>
            <option value="Angled Side">Angled Side</option>
            <option value="ShortPlusAngled">Short Plus Angled</option>
          </select>
        </div>
        
        <div class="field-group">
          <label>Piping</label>
          <select name="piping_${cushionIndex}" required>
            <option value="No">No</option>
            <option value="Yes">Yes</option>
          </select>
        </div>
        
        <div class="field-group">
          <label>Ties</label>
          <select name="ties_${cushionIndex}" required>
            <option value="None">None</option>
            <option value="2 Side">2 Side</option>
            <option value="2 Side Short">2 Side Short</option>
            <option value="2 Side Long">2 Side Long</option>
            <option value="2 Same Side Long">2 Same Side Long</option>
            <option value="2 Same Side Short">2 Same Side Short</option>
            <option value="2 Back Ties">2 Back Ties</option>
            <option value="2 Corner Ties">2 Corner Ties</option>
            <option value="4 Corner Ties">4 Corner Ties</option>
            <option value="2 Top Ties">2 Top Ties</option>
          </select>
        </div>
        
        <div class="field-group">
          <label>Quantity</label>
          <input type="number" name="quantity_${cushionIndex}" value="1" min="1" required>
        </div>

        <h4>Dimensions (fill in the measurements that apply to your cushion shape)</h4>
        <div class="shape-fields">
          <!-- Rectangle/Right Triangle -->
          <div class="field-group">
            <label>Length (inches)</label>
            <input type="number" step="0.1" name="length_${cushionIndex}" placeholder="Length">
          </div>
          <div class="field-group">
            <label>Width (inches)</label>
            <input type="number" step="0.1" name="width_${cushionIndex}" placeholder="Width">
          </div>
          <div class="field-group">
            <label>Thickness (inches)</label>
            <input type="number" step="0.1" name="thickness_${cushionIndex}" placeholder="Thickness">
          </div>
          
          <!-- Trapezium -->
          <div class="field-group">
            <label>Top Base (inches)</label>
            <input type="number" step="0.1" name="top_base_${cushionIndex}" placeholder="Top base">
          </div>
          <div class="field-group">
            <label>Bottom Base (inches)</label>
            <input type="number" step="0.1" name="bottom_base_${cushionIndex}" placeholder="Bottom base">
          </div>
          <div class="field-group">
            <label>Height (inches)</label>
            <input type="number" step="0.1" name="height_${cushionIndex}" placeholder="Height">
          </div>
          
          <!-- L-Shape/T-Shape -->
          <div class="field-group">
            <label>Top Width (inches)</label>
            <input type="number" step="0.1" name="top_width_${cushionIndex}" placeholder="Top width">
          </div>
          <div class="field-group">
            <label>Bottom Width (inches)</label>
            <input type="number" step="0.1" name="bottom_width_${cushionIndex}" placeholder="Bottom width">
          </div>
          <div class="field-group">
            <label>Ear (inches)</label>
            <input type="number" step="0.1" name="ear_${cushionIndex}" placeholder="Ear length">
          </div>
          
          <!-- Round/Semi-round -->
          <div class="field-group">
            <label>Diameter (inches)</label>
            <input type="number" step="0.1" name="diameter_${cushionIndex}" placeholder="Diameter">
          </div>
          
          <!-- Equilateral Triangle -->
          <div class="field-group">
            <label>Side (inches)</label>
            <input type="number" step="0.1" name="side_${cushionIndex}" placeholder="Side length">
          </div>
          
          <!-- Clipped Trapeze -->
          <div class="field-group">
            <label>Edge (inches)</label>
            <input type="number" step="0.1" name="edge_${cushionIndex}" placeholder="Edge length">
          </div>
          
          <!-- Curved Cushion -->
          <div class="field-group">
            <label>Front Width Straight (inches)</label>
            <input type="number" step="0.1" name="front_width_straight_${cushionIndex}" placeholder="Front width straight">
          </div>
          <div class="field-group">
            <label>Back Width Straight (inches)</label>
            <input type="number" step="0.1" name="back_width_straight_${cushionIndex}" placeholder="Back width straight">
          </div>
          <div class="field-group">
            <label>Front Width Curved (inches)</label>
            <input type="number" step="0.1" name="front_width_curved_${cushionIndex}" placeholder="Front width curved">
          </div>
          <div class="field-group">
            <label>Back Width Curved (inches)</label>
            <input type="number" step="0.1" name="back_width_curved_${cushionIndex}" placeholder="Back width curved">
          </div>
          
          <!-- Tapered Bolster -->
          <div class="field-group">
            <label>Top Thickness (inches)</label>
            <input type="number" step="0.1" name="top_thickness_${cushionIndex}" placeholder="Top thickness">
          </div>
          <div class="field-group">
            <label>Bottom Thickness (inches)</label>
            <input type="number" step="0.1" name="bottom_thickness_${cushionIndex}" placeholder="Bottom thickness">
          </div>
          
          <!-- Curved -->
          <div class="field-group">
            <label>Side Length (inches)</label>
            <input type="number" step="0.1" name="side_length_${cushionIndex}" placeholder="Side length">
          </div>
          <div class="field-group">
            <label>Middle Length (inches)</label>
            <input type="number" step="0.1" name="middle_length_${cushionIndex}" placeholder="Middle length">
          </div>
        </div>
      `;
      container.appendChild(div);
      cushionIndex++;
    }

    function removeCushion(button) {
      button.closest('.cushion-group').remove();
      // Reindex remaining cushions
      const cushions = document.querySelectorAll('.cushion-group');
      cushions.forEach((cushion, index) => {
        const inputs = cushion.querySelectorAll('input, select');
        inputs.forEach(input => {
          const name = input.name;
          if (name.includes('_')) {
            const parts = name.split('_');
            const newName = parts.slice(0, -1).join('_') + '_' + index;
            input.name = newName;
          }
        });
        const header = cushion.querySelector('h4');
        header.textContent = `Cushion ${index + 1}`;
      });
      cushionIndex = cushions.length;
    }

    document.getElementById("pdfForm").addEventListener("submit", async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const cushions = [];
      
      for (let i = 0; i < cushionIndex; i++) {
        const cushion = {
          cushion_name: formData.get(`cushion_name_${i}`),
          fill: formData.get(`fill_${i}`),
          fabric: formData.get(`fabric_${i}`),
          zipper: formData.get(`zipper_${i}`),
          piping: formData.get(`piping_${i}`),
          ties: formData.get(`ties_${i}`),
          quantity: parseInt(formData.get(`quantity_${i}`) || 1),
          
          // Rectangle/Right Triangle
          length: parseFloat(formData.get(`length_${i}`) || 0),
          width: parseFloat(formData.get(`width_${i}`) || 0),
          thickness: parseFloat(formData.get(`thickness_${i}`) || 0),
          
          // Trapezium
          top_base: parseFloat(formData.get(`top_base_${i}`) || 0),
          bottom_base: parseFloat(formData.get(`bottom_base_${i}`) || 0),
          height: parseFloat(formData.get(`height_${i}`) || 0),
          
          // L-Shape/T-Shape
          top_width: parseFloat(formData.get(`top_width_${i}`) || 0),
          bottom_width: parseFloat(formData.get(`bottom_width_${i}`) || 0),
          ear: parseFloat(formData.get(`ear_${i}`) || 0),
          
          // Round/Semi-round
          diameter: parseFloat(formData.get(`diameter_${i}`) || 0),
          
          // Equilateral Triangle
          side: parseFloat(formData.get(`side_${i}`) || 0),
          
          // Clipped Trapeze
          edge: parseFloat(formData.get(`edge_${i}`) || 0),
          
          // Curved Cushion
          front_width_straight: parseFloat(formData.get(`front_width_straight_${i}`) || 0),
          back_width_straight: parseFloat(formData.get(`back_width_straight_${i}`) || 0),
          front_width_curved: parseFloat(formData.get(`front_width_curved_${i}`) || 0),
          back_width_curved: parseFloat(formData.get(`back_width_curved_${i}`) || 0),
          
          // Tapered Bolster
          top_thickness: parseFloat(formData.get(`top_thickness_${i}`) || 0),
          bottom_thickness: parseFloat(formData.get(`bottom_thickness_${i}`) || 0),
          
          // Curved
          side_length: parseFloat(formData.get(`side_length_${i}`) || 0),
          middle_length: parseFloat(formData.get(`middle_length_${i}`) || 0)
        };
        cushions.push(cushion);
      }

      const payload = {
        customer_name: formData.get("customer_name"),
        order_id: formData.get("order_id"),
        email: formData.get("email"),
        shipping_address: formData.get("shipping_address").split("\n").filter(line => line.trim()),
        billing_address: formData.get("billing_address").split("\n").filter(line => line.trim()),
        cushions: cushions
      };

      try {
        const response = await fetch("/generate-confirmation", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const result = await response.json();
        if (result.pdf_link) {
          window.open(result.pdf_link, "_blank");
        } else {
          alert("Error: " + JSON.stringify(result));
        }
      } catch (error) {
        alert("Error submitting form: " + error.message);
      }
    });

    addCushion(); // initialize with one cushion form
  </script>
</body>
</html>
