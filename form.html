<!DOCTYPE html>
<html>
<head>
    <title>Cushion Order Form</title>
</head>
<body>
    <h2>Cushion Order Form</h2>
    <form action="/generate-confirmation" method="post" enctype="application/json" onsubmit="submitForm(event)">
        <label>Customer Name: <input type="text" id="customer_name"></label><br>
        <label>Order ID: <input type="text" id="order_id"></label><br>
        <label>Email: <input type="email" id="email"></label><br>
        <label>Shipping Address (comma-separated): <input type="text" id="shipping_address"></label><br>
        <label>Billing Address (comma-separated): <input type="text" id="billing_address"></label><br><br>

        <h3>Cushion Details</h3>
        <label>Name: <input type="text" id="cushion_name"></label><br>
        <label>Shape:
            <select id="shape" onchange="toggleShapeFields()">
                <option value="rectangle">Rectangle</option>
                <option value="trapezoid">Trapezoid</option>
            </select>
        </label><br>

        <div id="rectangleFields">
            <label>Length: <input type="number" step="0.1" id="length"></label><br>
            <label>Width: <input type="number" step="0.1" id="width"></label><br>
        </div>

        <div id="trapezoidFields" style="display: none;">
            <label>Top Base: <input type="number" step="0.1" id="top_base"></label><br>
            <label>Bottom Base: <input type="number" step="0.1" id="bottom_base"></label><br>
            <label>Height: <input type="number" step="0.1" id="height"></label><br>
        </div>

        <label>Thickness: <input type="number" step="0.1" id="thickness"></label><br>
        <label>Fill: <input type="text" id="fill"></label><br>
        <label>Fabric: <input type="text" id="fabric"></label><br>
        <label>Zipper Position: <input type="text" id="zipper"></label><br>
        <label>Piping (Yes/No): <input type="text" id="piping"></label><br>
        <label>Ties: <input type="text" id="ties"></label><br>
        <label>Quantity: <input type="number" id="quantity" value="1"></label><br><br>

        <button type="submit">Submit</button>
    </form>

    <script>
        function toggleShapeFields() {
            const shape = document.getElementById('shape').value;
            document.getElementById('rectangleFields').style.display = shape === 'rectangle' ? 'block' : 'none';
            document.getElementById('trapezoidFields').style.display = shape === 'trapezoid' ? 'block' : 'none';
        }

        function submitForm(event) {
            event.preventDefault();

            const shape = document.getElementById('shape').value;
            let cushion = {
                cushion_name: document.getElementById('cushion_name').value,
                shape: shape,
                thickness: parseFloat(document.getElementById('thickness').value),
                fill: document.getElementById('fill').value,
                fabric: document.getElementById('fabric').value,
                zipper: document.getElementById('zipper').value,
                piping: document.getElementById('piping').value,
                ties: document.getElementById('ties').value,
                quantity: parseInt(document.getElementById('quantity').value)
            };

            if (shape === 'rectangle') {
                cushion.length = parseFloat(document.getElementById('length').value);
                cushion.width = parseFloat(document.getElementById('width').value);
            } else {
                cushion.top_base = parseFloat(document.getElementById('top_base').value);
                cushion.bottom_base = parseFloat(document.getElementById('bottom_base').value);
                cushion.height = parseFloat(document.getElementById('height').value);
            }

            const payload = {
                customer_name: document.getElementById('customer_name').value,
                order_id: document.getElementById('order_id').value,
                email: document.getElementById('email').value,
                shipping_address: document.getElementById('shipping_address').value.split(','),
                billing_address: document.getElementById('billing_address').value.split(','),
                cushions: [cushion]
            };

            fetch("/generate-confirmation", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                if (data.pdf_link) {
                    window.location.href = data.pdf_link;
                } else {
                    alert("Error: " + JSON.stringify(data));
                }
            });
        }
    </script>
</body>
</html>


